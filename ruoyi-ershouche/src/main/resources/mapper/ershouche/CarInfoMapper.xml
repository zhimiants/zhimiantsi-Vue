<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.ershouche.mapper.CarInfoMapper">
    
    <resultMap type="CarInfo" id="CarInfoResult">
        <result property="id"    column="id"    />
        <result property="brandId"    column="brand_id"    />
        <result property="modelId"    column="model_id"    />
        <result property="vin"    column="vin"    />
        <result property="color"    column="color"    />
        <result property="year"    column="year"    />
        <result property="mileage"    column="mileage"    />
        <result property="fuelType"    column="fuel_type"    />
        <result property="sellingPrice"    column="selling_price"    />
        <result property="status"    column="status"    />
        <result property="isSpecialOffer"    column="is_special_offer"    />
        <result property="location"    column="location"    />
        <result property="conditionDesc"    column="condition_desc"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <resultMap id="CarInfoCarImageResult" type="CarInfo" extends="CarInfoResult">
        <collection property="carImageList" ofType="CarImage" column="id" select="selectCarImageList" />
    </resultMap>

    <resultMap type="CarImage" id="CarImageResult">
        <result property="id"    column="id"    />
        <result property="carId"    column="car_id"    />
        <result property="imageUrl"    column="image_url"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <sql id="selectCarInfoVo">
        select id, brand_id, model_id, vin, color, year, mileage, fuel_type, selling_price, status, is_special_offer, location, condition_desc, create_time, update_time, remark from tb_car_info
    </sql>

    <select id="selectCarInfoList" parameterType="CarInfo" resultMap="CarInfoResult">
        <include refid="selectCarInfoVo"/>
        <where>  
        </where>
    </select>
    
    <select id="selectCarInfoById" parameterType="Long" resultMap="CarInfoCarImageResult">
        select id, brand_id, model_id, vin, color, year, mileage, fuel_type, selling_price, status, is_special_offer, location, condition_desc, create_time, update_time, remark
        from tb_car_info
        where id = #{id}
    </select>

    <select id="selectCarImageList" resultMap="CarImageResult">
        select id, car_id, image_url, create_time, update_time, remark
        from tb_car_image
        where car_id = #{car_id}
    </select>

    <insert id="insertCarInfo" parameterType="CarInfo" useGeneratedKeys="true" keyProperty="id">
        insert into tb_car_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="brandId != null">brand_id,</if>
            <if test="modelId != null">model_id,</if>
            <if test="vin != null">vin,</if>
            <if test="color != null">color,</if>
            <if test="year != null">year,</if>
            <if test="mileage != null">mileage,</if>
            <if test="fuelType != null">fuel_type,</if>
            <if test="sellingPrice != null">selling_price,</if>
            <if test="status != null">status,</if>
            <if test="isSpecialOffer != null">is_special_offer,</if>
            <if test="location != null">location,</if>
            <if test="conditionDesc != null">condition_desc,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="brandId != null">#{brandId},</if>
            <if test="modelId != null">#{modelId},</if>
            <if test="vin != null">#{vin},</if>
            <if test="color != null">#{color},</if>
            <if test="year != null">#{year},</if>
            <if test="mileage != null">#{mileage},</if>
            <if test="fuelType != null">#{fuelType},</if>
            <if test="sellingPrice != null">#{sellingPrice},</if>
            <if test="status != null">#{status},</if>
            <if test="isSpecialOffer != null">#{isSpecialOffer},</if>
            <if test="location != null">#{location},</if>
            <if test="conditionDesc != null">#{conditionDesc},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
         </trim>
    </insert>

    <update id="updateCarInfo" parameterType="CarInfo">
        update tb_car_info
        <trim prefix="SET" suffixOverrides=",">
            <if test="brandId != null">brand_id = #{brandId},</if>
            <if test="modelId != null">model_id = #{modelId},</if>
            <if test="vin != null">vin = #{vin},</if>
            <if test="color != null">color = #{color},</if>
            <if test="year != null">year = #{year},</if>
            <if test="mileage != null">mileage = #{mileage},</if>
            <if test="fuelType != null">fuel_type = #{fuelType},</if>
            <if test="sellingPrice != null">selling_price = #{sellingPrice},</if>
            <if test="status != null">status = #{status},</if>
            <if test="isSpecialOffer != null">is_special_offer = #{isSpecialOffer},</if>
            <if test="location != null">location = #{location},</if>
            <if test="conditionDesc != null">condition_desc = #{conditionDesc},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteCarInfoById" parameterType="Long">
        delete from tb_car_info where id = #{id}
    </delete>

    <delete id="deleteCarInfoByIds" parameterType="String">
        delete from tb_car_info where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <delete id="deleteCarImageByCarIds" parameterType="String">
        delete from tb_car_image where car_id in 
        <foreach item="carId" collection="array" open="(" separator="," close=")">
            #{carId}
        </foreach>
    </delete>

    <delete id="deleteCarImageByCarId" parameterType="Long">
        delete from tb_car_image where car_id = #{carId}
    </delete>

    <insert id="batchCarImage">
        insert into tb_car_image( id, car_id, image_url, create_time, update_time, remark) values
        <foreach item="item" index="index" collection="list" separator=",">
            ( #{item.id}, #{item.carId}, #{item.imageUrl}, #{item.createTime}, #{item.updateTime}, #{item.remark})
        </foreach>
    </insert>
</mapper>